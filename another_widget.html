<!DOCTYPE html>
<html>
<head>
    <title>Chatbot Widget</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.2.0/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div id="chat-container">
        <div id="message-container"></div>
        <div id="user-input">
            <input type="text" id="user-message" placeholder="Type your message..." />
            <button id="send-button">Send</button>
        </div>
    </div>

    <script>
        // Connect to the Rasa server using SocketIO
        const socket = io('http://0.0.0.0:5005/websocket/');
        socket.on('connect', () => {
            console.log('Connected to Rasa server');
        });

        // Send user message to Rasa and receive bot responses
        function sendMessage() {
            const userInput = $('#user-message').val();
            if (userInput.trim() !== '') {
                const message = { 'message': userInput };
                socket.emit('user_uttered', message);
                addMessage(userInput, 'user');
                $('#user-message').val('');
            }
        }

        // Display bot responses in the chat widget
        function displayBotResponse(response) {
            const botResponse = response[0]['text'];
            addMessage(botResponse, 'bot');
        }

        // Add a message to the chat container
        function addMessage(message, sender) {
            const container = $('#message-container');
            const messageElement = $('<div class="message"></div>').text(message);
            if (sender === 'user') {
                messageElement.addClass('user-message');
            } else {
                messageElement.addClass('bot-message');
            }
            container.append(messageElement);
            container.scrollTop(container[0].scrollHeight);
        }

        // Listen for bot responses from the Rasa server
        socket.on('bot_uttered', (response) => {
            displayBotResponse(response);
        });

        // Send user message when the send button is clicked
        $('#send-button').click(() => {
            sendMessage();
        });

        // Send user message when the Enter key is pressed
        $('#user-message').keypress((event) => {
            if (event.which === 13) {
                sendMessage();
                event.preventDefault();
            }
        });
    </script>
</body>
</html>
